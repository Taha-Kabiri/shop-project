
<div class="dashboard-wrapper">
  <div class="header-section">
    <div class="welcome-box">
      <h2 class="welcome-title">Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒØŒ <%= user?.name || "Ú©Ø§Ø±Ø¨Ø± Ø¹Ø²ÛŒØ²" %> âœ¨</h2>
      <p class="welcome-subtitle">Ø¯Ø± ME KALAØŒ Ø¨Ù‡ØªØ±ÛŒÙ†â€ŒÙ‡Ø§ Ù…Ù†ØªØ¸Ø± Ø´Ù…Ø§Ø³Øª.</p>
    </div>

    <% if (user && user.role === 'admin') { %>
      <div class="admin-zone">
        <a href="/products/add" class="admin-btn-luxury">
          <span>â• Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</span>
        </a>
      </div>
    <% } %>
  </div>

  <% if (user && user.role !== 'admin') { %>
    <div class="card p-3 mt-3">
      <h4>Ø§Ø±ØªÙ‚Ø§ÛŒ Ø­Ø³Ø§Ø¨ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† (ÛµÛ°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†)</h4>
      <p>Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§: <%= user.walletBalance?.toLocaleString() %> Ø±ÛŒØ§Ù„</p>
      
      <form action="/wallet/upgrade-with-wallet" method="POST">
        <button type="submit" class="btn btn-success" 
          <%= (user.walletBalance < 500000) ? 'disabled' : '' %>>
          Ø§Ø±ØªÙ‚Ø§ Ø¨Ø§ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©ÛŒÙ Ù¾ÙˆÙ„
        </button>
      </form>
      
      <% if (user.walletBalance < 500000) { %>
        <small class="text-danger">Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª (Ø­Ø¯Ø§Ù‚Ù„ ÛµÛ°Û°,Û°Û°Û° Ø±ÛŒØ§Ù„ Ù†ÛŒØ§Ø² Ø§Ø³Øª).</small>
      <% } %>
    </div>
  <% } %>

  <div class="content-divider">
    <span>ğŸ’ ÙˆÛŒØªØ±ÛŒÙ† Ù…Ø­ØµÙˆÙ„Ø§Øª ğŸ’</span>
  </div>

  <div class="product-grid">
    <% if (products && products.length > 0) { %>
      <% products.forEach(product => { %>
        <div class="product-card">
          <div class="img-container">
            <img src="<%= product.image || product.imageUrl %>" alt="<%= product.title %>" class="product-img-main">
            <div class="img-badge">ÙˆÛŒÚ˜Ù‡</div>
          </div>

          <div class="card-body">
            <h3><%= product.title %></h3>
            <p class="description">
              <%= product.description ? product.description.substring(0, 80) + '...' : 'ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø­ØµÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø¨ÛŒØ´ØªØ± Ø´Ù…Ø§...' %>
            </p>

            <div class="price-row">
              <span class="price-tag"><%= product.price.toLocaleString() %></span>
              <span class="currency">ØªÙˆÙ…Ø§Ù†</span>
            </div>

            <form action="/cart/add/<%= product._id %>" method="POST" class="add-to-cart-form">
              <input type="hidden" name="productId" value="<%= product._id %>">
              <button type="button" class="buy-btn-premium" onclick="addToCartEffect(this, '<%= product.image || product.imageUrl %>')">
                <span class="btn-text">Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</span>
                <span class="btn-icon">ğŸ›’</span>
              </button>
            </form>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <div class="empty-state">Ù‡Ù†ÙˆØ² Ù…Ø­ØµÙˆÙ„ÛŒ Ø¯Ø± ÙˆÛŒØªØ±ÛŒÙ† Ù‚Ø±Ø§Ø± Ù†Ú¯Ø±ÙØªÙ‡ Ø§Ø³Øª.</div>
    <% } %>
  </div>

  <footer class="premium-footer">
    <div class="footer-content">
      <div class="footer-logo">ME KALA</div>
      <p>ØªØ¬Ø±Ø¨Ù‡â€ŒØ§ÛŒ Ù…ØªÙØ§ÙˆØª Ø§Ø² Ø®Ø±ÛŒØ¯ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø¨Ø§ Ø§Ø³ØªØ§ÛŒÙ„ Ø®Ø§Øµ Ø´Ù…Ø§</p>
      <div class="footer-links">
        <span>Ø¶Ù…Ø§Ù†Øª Ø§ØµØ§Ù„Øª Ú©Ø§Ù„Ø§</span>
        <span class="dot">â€¢</span>
        <span>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Û²Û´ Ø³Ø§Ø¹ØªÙ‡</span>
        <span class="dot">â€¢</span>
        <span>Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ù…Ù†</span>
      </div>
    </div>
    <div class="footer-bottom">
      &copy; Û²Û°Û²Ûµ ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ø¨Ø±Ø§ÛŒ ME KALA Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª
    </div>
  </footer>
</div>

<style>
  :root {
    --primary-dark: #2D2424;
    --accent-brown: #967E76;
    --beige-light: #D7C0AE;
    --cream-bg: #F9F7F2;
    --white-soft: #FFFFFF;
  }

  .dashboard-wrapper {
    background-color: var(--cream-bg);
    min-height: 100vh;
    padding: 0;
    font-family: 'Tahoma', sans-serif;
    direction: rtl;
  }

  .header-section {
    padding: 50px 40px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .welcome-title { color: var(--primary-dark); font-size: 1.8rem; font-weight: 800; margin: 0; }
  .welcome-subtitle { color: var(--accent-brown); margin-top: 10px; font-size: 1rem; }

  .admin-btn-luxury {
    background: var(--accent-brown);
    color: #fff;
    padding: 12px 25px; border-radius: 15px;
    text-decoration: none; font-weight: bold;
    transition: 0.3s;
    box-shadow: 0 4px 15px rgba(150, 126, 118, 0.3);
  }
  .admin-btn-luxury:hover { background: var(--primary-dark); transform: translateY(-3px); }

  .card {
    background: #fff;
    border-radius: 20px;
    border: 1px solid var(--beige-light);
    margin: 0 40px;
  }

  .content-divider { text-align: center; margin: 40px 0; color: var(--beige-light); font-weight: bold; }

  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 35px; padding: 0 40px 60px;
  }

  .product-card {
    background: var(--white-soft); border: 1px solid var(--beige-light);
    border-radius: 25px; overflow: hidden; transition: 0.4s;
    position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.03);
  }
  .product-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(150, 126, 118, 0.15); }

  .img-container { height: 230px; position: relative; }
  .product-img-main { width: 100%; height: 100%; object-fit: cover; }
  .img-badge {
    position: absolute;
    top: 15px; left: 15px;
    background: rgba(255,255,255,0.9); color: var(--primary-dark);
    padding: 5px 12px; border-radius: 10px; font-size: 0.7rem; font-weight: bold;
  }

  .card-body { padding: 25px; }
  .card-body h3 { color: var(--primary-dark); font-size: 1.2rem; margin-bottom: 12px; }
  .description { font-size: 0.85rem; color: #777; line-height: 1.6; margin-bottom: 20px; }

  .price-row { margin-bottom: 20px; display: flex; align-items: baseline; gap: 5px; }
  .price-tag { font-size: 1.6rem; font-weight: 900; color: var(--accent-brown); }
  .currency { font-size: 0.8rem; color: #999; }

  .buy-btn-premium {
    width: 100%; padding: 15px;
    background: var(--accent-brown);
    color: #fff; border: none; border-radius: 18px;
    font-weight: bold; cursor: pointer; transition: 0.3s;
    display: flex; justify-content: center; align-items: center;
    gap: 10px;
  }
  .buy-btn-premium:hover { background: var(--primary-dark); }

  .premium-footer {
    background-color: var(--primary-dark);
    color: var(--beige-light);
    padding: 60px 40px 30px;
    text-align: center;
    border-top-left-radius: 50px;
    border-top-right-radius: 50px;
  }
  .footer-logo { font-size: 1.8rem; font-weight: 900; color: var(--white-soft); margin-bottom: 15px; }
  .footer-links { margin: 25px 0; font-size: 0.9rem; color: var(--accent-brown); }
  .dot { margin: 0 10px; }
  .footer-bottom { margin-top: 40px; padding-top: 20px; border-top: 1px solid rgba(150, 126, 118, 0.2); font-size: 0.8rem; }

  .flying-item {
    position: fixed;
    z-index: 9999;
    width: 60px; height: 60px; border-radius: 50%;
    object-fit: cover; pointer-events: none;
    transition: all 0.8s cubic-bezier(0.1, 0.5, 0.3, 1);
    box-shadow: 0 10px 25px rgba(0,0,0,0.3); border: 2px solid #fff;
  }
</style>

<script>
function addToCartEffect(btn, imgUrl) {
    const originalText = btn.querySelector('.btn-text').innerHTML;
    btn.classList.add('btn-active-shake');
    btn.querySelector('.btn-text').innerText = 'âœ… Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯';
    
    const img = document.createElement('img');
    img.src = imgUrl;
    img.classList.add('flying-item');
    
    const rect = btn.getBoundingClientRect();
    img.style.left = rect.left + (rect.width / 2) - 30 + 'px';
    img.style.top = rect.top + 'px';
    document.body.appendChild(img);

    setTimeout(() => {
        img.style.left = '50px'; 
        img.style.top = '20px';
        img.style.transform = 'scale(0) rotate(720deg)';
        img.style.opacity = '0';
    }, 50);

    setTimeout(() => {
        img.remove();
        btn.classList.remove('btn-active-shake');
        btn.querySelector('.btn-text').innerHTML = originalText;
        btn.closest('form').submit();
    }, 850);
}
</script>